{% extends "base.html" %}
{% block content %}

{% if messages %}
    <div class="messages-container">
        {% for message in messages %}
            <div class="alert {{ message.tags }}">
                {{ message }}
            </div>
        {% endfor %}
    </div>
{% endif %}

<div class="profile-container">
    <div class="sidebar">
        <div class="menu-section">
            <h3>Меню</h3>
            <button data-url="{% url 'personal_account:user_profile' username=user.username %}" class="menu-item active">Профиль</button>
            <button id="payment-schedule-btn" class="menu-item">Мои платежи</button>
            <div id="payment-schedule-submenu" class="submenu">
                <button class="submenu-item">Исторя платежей</button>
                <button class="submenu-item">Сделать платёж</button>
                <button class="submenu-item" data-url="{% url 'personal_account:requisites' %}">Реквизиты</button>
                <button class="submenu-item" data-url="{% url 'donation' %}">Добровольное пожертвование</button>
            </div>
            <button data-url="{% url 'personal_account:plug' %}" class="menu-item">График платежей</button>
            <button data-url="{% url 'personal_account:plug_1' %}" class="menu-item">Очередь</button>
            <button data-url="{% url 'personal_account:plug_2' %}" class="menu-item">Долги</button>
            <button data-url="{% url 'personal_account:plug_3' %}" class="menu-item">Уведомления</button>
            <button data-url="{% url 'personal_account:plug' %}" class="menu-item">Помощь</button>
        </div>
    </div>
    
    <div class="content">
        <div class="profile-header">
            <h2>Ваш профиль - {{ user_profile.last_name }} {{ user_profile.first_name }}</h2>
            <h3>{{ user.profile.id_coor }}</h3>
            <h5>{{ user.profile.status }}</h5>
        </div>

        <div class="info-section">
            <div class="info-row">
                <div class="info-label">Email пользователя:</div>
                <div class="info-value">{{ user_profile }}</div>
            </div>
            
            <div class="info-row">
                <div class="info-label">Номер телефона:</div>
                <div class="info-value">{{ user.profile.phone }}</div>
            </div>
            
            <div class="info-row">
                <div class="info-label">Имя:</div>
                <div class="info-value">{{ user_profile.first_name }}</div>
            </div>
            
            <div class="info-row">
                <div class="info-label">Фамилия:</div>
                <div class="info-value">{{ user_profile.last_name }}</div>
            </div>
            
            <div class="info-row">
                <div class="info-label">Отчество:</div>
                <div class="info-value">{{ user.profile.surname }}</div>
            </div>

            <div class="info-row">
                <div class="info-label">Дата рождения:</div>
                <div class="info-value">{{ user.profile.birth_date }}</div>
            </div>

            <div class="info-row">
                <div class="info-label">Тип покупки:</div>
                <div class="info-value">{{ user.profile.type_of_purchase }}</div>
            </div>

            <div class="info-row">
                <div class="info-label">Стоимость объекта недвижимости:</div>
                <div class="info-value">{{ user.profile.price }} (руб)</div>
            </div>

            <div class="info-row">
                <div class="info-label">Стоимость объекта недвижимости при переходе в очередь:</div>
                <div class="info-value">{{ user.profile.price_in_queue }} (руб)</div>
            </div>

            <div class="info-row">
                <div class="info-label">ИНН:</div>
                <div class="info-value">{{ user.profile.inn }}</div>
            </div>

            <div class="info-row">
                <div class="info-label">Документ:</div>
                <div class="info-value">{{ user.profile.document_type }}</div>
            </div>

            <div class="info-row">
                <div class="info-label">Серия и номер паспорта:</div>
                <div class="info-value">{{ user.profile.id_document }}</div>
            </div>

            <div class="info-row">
                <div class="info-label">Фото главной страницы:</div>
                {% if user.profile.document_photo_main %}✓{% else %}✗{% endif %}
            </div>

            <div class="info-row">
                <div class="info-label">Фото прописки:</div>
                {% if user.profile.document_photo_reg %}✓{% else %}✗{% endif %}
            </div>

            <div class="info-row">
                <div class="info-label">Дата выдачи:</div>
                <div class="info-value">{{ user.profile.date_of_issue }}</div>
            </div>

            <div class="info-row_next">
                <div class="info-label">Орган, выдавший документ:</div>
                <div class="info-value">{{ user.profile.issued_by_whom }}</div>
            </div>
        </div>

        <div class="profile-header">
            <h2>Информация о партнёре</h2>
        </div>
        <div class="info-section">
            <div class="info-row">
                <div class="info-label">Фамилия и имя, пригласившего вас, партнёра:</div>
                <div class="info-value">{{ user.profile.parther_name }}</div>
            </div>
            
            <div class="info-row_next">
                <div class="info-label">Номер телефона пригласителя:</div>
                <div class="info-value">{{ user.profile.parther_phone }}</div>
            </div>
        </div>

        <div class="profile-header">
            <h2>Адрес регистрации</h2>
        </div>
        <div class="info-section">
            <div class="info-row">
                <div class="info-label">Страна:</div>
                <div class="info-value">{{ user.profile_address.reg_country }}</div>
            </div>
            
            <div class="info-row">
                <div class="info-label">Регион:</div>
                <div class="info-value">{{ user.profile_address.reg_region }}</div>
            </div>
            
            <div class="info-row">
                <div class="info-label">Город:</div>
                <div class="info-value">{{ user.profile_address.reg_city }}</div>
            </div>
            
            <div class="info-row">
                <div class="info-label">Полный адрес:</div>
                <div class="info-value">{{ user.profile_address.reg_address }}</div>
            </div>
            
            <div class="info-row">
                <div class="info-label">Улица:</div>
                <div class="info-value">{{ user.profile_address.reg_street }}</div>
            </div>

            <div class="info-row">
                <div class="info-label">Дом:</div>
                <div class="info-value">{{ user.profile_address.reg_house }}</div>
            </div>
            
            <div class="info-row">
                <div class="info-label">Квартира:</div>
                <div class="info-value">{{ user.profile_address.reg_apartament }}</div>
            </div>

            <div class="info-row_next">
                <div class="info-label">Почтовый индекс:</div>
                <div class="info-value">{{ user.profile_address.reg_postal_code }}</div>
            </div>
        </div>

        <div class="profile-header">
            <h2>Фактический адрес проживания</h2>
        </div>
        <div class="info-section">
            <div class="info-row">
                <div class="info-label">Страна:</div>
                <div class="info-value">{{ user.profile_address.act_country }}</div>
            </div>
            
            <div class="info-row">
                <div class="info-label">Регион:</div>
                <div class="info-value">{{ user.profile_address.act_region }}</div>
            </div>
            
            <div class="info-row">
                <div class="info-label">Город:</div>
                <div class="info-value">{{ user.profile_address.act_city }}</div>
            </div>
            
            <div class="info-row">
                <div class="info-label">Полный адрес:</div>
                <div class="info-value">{{ user.profile_address.act_address }}</div>
            </div>
            
            <div class="info-row">
                <div class="info-label">Улица:</div>
                <div class="info-value">{{ user.profile_address.act_street }}</div>
            </div>

            <div class="info-row">
                <div class="info-label">Дом:</div>
                <div class="info-value">{{ user.profile_address.act_house }}</div>
            </div>

            <div class="info-row">
                <div class="info-label">Квартира:</div>
                <div class="info-value">{{ user.profile_address.act_apartament }}</div>
            </div>
            
            <div class="info-row_next">
                <div class="info-label">Почтовый индекс:</div>
                <div class="info-value">{{ user.profile_address.act_postal_code }}</div>
            </div>
        </div>
        
        {% if user_profile == user %}
            <div class="profile-actions">
                <a class="edit-button" href="profile_edit">Настройки профиля</a>
            </div>
        {% endif %}
    </div>
</div>

<style>
    html, body {
        -webkit-text-size-adjust: 100%;
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        background: #f1f3f5;
        color: #212529;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        line-height: 1.4;
    }
    *, *::before, *::after { box-sizing: inherit; }

    .profile-container {
        display: flex;
        width: 100%;
        max-width: 1200px;
        margin: 20px auto;
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        padding: 0 12px;
    }

    .sidebar, .content { min-width: 0; }

    .sidebar {
        width: 33.333%;
        background: #f8f9fa;
        padding: 25px;
        border-right: 1px solid #e9ecef;
    }

    .menu-section { margin-bottom: 30px; }

    .menu-section h3 {
        font-size: 18px;
        color: #212529;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid #dee2e6;
    }

    .menu-item {
        display: flex;
        align-items: center;
        padding: 12px 15px;
        margin-bottom: 8px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        color: #495057;
        text-decoration: none;
        background: white;
        border: 1px solid #e9ecef;
        width: 100%;
        text-align: left;
        font-family: inherit;
        font-size: inherit;
        word-break: break-word;
        overflow-wrap: anywhere;
    }

    .menu-item:hover { background: #e9ecef; border-color: #ced4da; }

    .menu-item.active { background: #007bff; color: white; border-color: #007bff; font-weight: 500; }

    .content { width: 66.667%; padding: 30px; }

    .profile-header { margin-bottom: 30px; padding-bottom: 15px; border-bottom: 5px solid #e9ecef; }
    .profile-header h2 { font-size: 24px; color: #212529; margin: 0; }

    .info-section { margin-bottom: 25px; }

    .info-row, .info-row_next {
        display: flex;
        gap: 12px;
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 1px solid #f1f3f5;
        align-items: flex-start;
    }

    .info-row_next { border-bottom: 5px solid #e9ecef; }

    .info-label { width: 40%; color: #6c757d; font-weight: 500; min-width: 0; }
    .info-value { width: 60%; color: #212529; font-weight: 400; min-width: 0; }

    .profile-actions { margin-top: 25px; padding-top: 15px; border-top: 1px solid #e9ecef; }

    .edit-button { display: inline-block; padding: 10px 20px; background: #007bff; color: white; text-decoration: none; border-radius: 6px; font-weight: 500; transition: background 0.2s ease; }
    .edit-button:hover { background: #0069d9; text-decoration: none; color: white; }
    .submenu {
        display: none;
        margin-left: 15px;
        margin-top: 5px;
        background: #ffffff;
        border-left: 3px solid #007bff;
        border-radius: 6px;
        padding: 8px 10px;
        box-shadow: 0 1px 5px rgba(0,0,0,0.1);
        max-width: calc(100% - 30px);
        box-sizing: border-box;
    }

    .submenu-item {
        display: block;
        width: 100%;
        background: #f8f9fa;
        border: none;
        padding: 8px 10px;
        margin-bottom: 5px;
        border-radius: 6px;
        cursor: pointer;
        text-align: left;
        font-size: 14px;
        color: #495057;
        transition: all 0.2s ease;
    }

    .submenu-item:hover { background: #e9ecef; }

    .messages-container {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 1050;
        text-align: center;
        width: 90vw;            /* важно: не больше ширины экрана */
        max-width: 600px;
        box-sizing: border-box;
        max-height: 80vh;
        overflow-y: auto;
        padding: 0 8px;
    }
    .alert { padding: 15px 20px; border-radius: 8px; font-size: 18px; font-weight: 500; margin: 10px 0; box-shadow: 0 4px 15px rgba(0,0,0,0.2); animation: fadeIn 0.5s ease; }
    .alert.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .alert.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .alert.warning { background: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
    .alert.info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    .alert.fade-out { animation: fadeOut 0s ease forwards; }
    @keyframes fadeOut { from { opacity: 0; } to { opacity: 1; } }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    img, svg, iframe, video, table { max-width: 100%; height: auto; display: ; }

    @media (max-width: 992px) {
        .profile-container { flex-direction: column; padding: 0 10px; }
        .sidebar, .content { width: 100%; }
        .sidebar { border-right: none; border-bottom: 1px solid #e9ecef; }
    }

    @media (max-width: 576px) {
        .profile-container { margin: 12px 8px; border-radius: 8px; }
        .sidebar { padding: 16px; }
        .content { padding: 18px; }
        .info-row, .info-row_next { flex-direction: column; padding-bottom: 12px; }
        .info-label, .info-value { width: 100%; }
        .menu-item { padding: 10px 12px; font-size: 14px; white-space: normal; }
        .messages-container { top: auto; bottom: 16px; left: 50%; transform: translateX(-50%); width: calc(100% - 24px); max-width: calc(100% - 24px); }
        .submenu { margin-left: 0; padding-left: 10px; }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const menuItems = document.querySelectorAll('.menu-item');
        const currentUrl = window.location.href;
        
        menuItems.forEach(item => {
            const itemUrl = item.getAttribute('data-url');
            if (currentUrl.includes(itemUrl) && itemUrl !== '#') {
                menuItems.forEach(i => i.classList.remove('active'));
                item.classList.add('active');
            }
        });
        
        menuItems.forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                
                menuItems.forEach(i => i.classList.remove('active'));
                
                this.classList.add('active');
                
                const url = this.getAttribute('data-url');
                if (url && url !== '#') {
                    window.location.href = url;
                }
            });
        });
    });

    document.addEventListener('DOMContentLoaded', function() {
        const alerts = document.querySelectorAll('.alert');
        
        alerts.forEach(alert => {
            setTimeout(() => {
                alert.classList.add('fade-out');
                
                alert.addEventListener('animationend', function() {
                    alert.remove();
                    
                    if (document.querySelectorAll('.alert').length === 0) {
                        document.querySelector('.messages-container')?.remove();
                    }
                });
            }, 2500);
        });
    });

    document.addEventListener('DOMContentLoaded', function() {
        const paymentScheduleBtn = document.getElementById('payment-schedule-btn');
        const submenu = document.getElementById('payment-schedule-submenu');

        // раскрытие/скрытие подменю
        paymentScheduleBtn.addEventListener('click', function(e) {
            e.preventDefault();
            submenu.style.display = submenu.style.display === 'block' ? 'none' : 'block';
        });

        // клики по пунктам подменю
        const submenuItems = document.querySelectorAll('.submenu-item');
        submenuItems.forEach(item => {
            item.addEventListener('click', function() {
                const url = this.getAttribute('data-url');
                if (url) {
                    window.location.href = url; // переход по ссылке
                }
            });
        });

        // скрывать подменю при клике вне него
        document.addEventListener('click', function(e) {
            if (!paymentScheduleBtn.contains(e.target) && !submenu.contains(e.target)) {
                submenu.style.display = 'none';
            }
        });
    });
</script>
{% endblock %}
